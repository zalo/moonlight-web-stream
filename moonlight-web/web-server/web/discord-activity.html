<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cloud Gaming - Discord Activity</title>
    <link rel="stylesheet" href="./styles/standard.css">

    <!-- Import map for Discord SDK and other npm modules -->
    <script type="importmap">
    {
        "imports": {
            "@discord/embedded-app-sdk": "https://esm.sh/@discord/embedded-app-sdk@1.4.0"
        }
    }
    </script>
    <style>
        :root {
            --discord-blurple: #5865F2;
            --discord-green: #57F287;
            --discord-yellow: #FEE75C;
            --discord-red: #ED4245;
            --discord-dark: #23272A;
            --discord-darker: #2C2F33;
            --discord-darkest: #1E2124;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'gg sans', 'Noto Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background: var(--discord-darkest);
            color: #dcddde;
            min-height: 100vh;
            overflow: hidden;
        }

        .activity-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* Header bar */
        .activity-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 16px;
            background: var(--discord-darker);
            border-bottom: 1px solid rgba(255,255,255,0.06);
        }

        .activity-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            font-size: 14px;
        }

        .activity-title svg {
            width: 20px;
            height: 20px;
        }

        /* Stream container */
        .stream-container {
            flex: 1;
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #stream-video {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .stream-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.8);
            flex-direction: column;
            gap: 16px;
        }

        .stream-overlay.hidden {
            display: none;
        }

        /* Loading state */
        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--discord-darker);
            border-top-color: var(--discord-blurple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 16px;
            color: #b9bbbe;
        }

        /* Participants panel */
        .participants-panel {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 60px;
            width: 240px;
            background: rgba(35,39,42,0.95);
            border-left: 1px solid rgba(255,255,255,0.06);
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.2s ease;
        }

        .participants-panel.open {
            transform: translateX(0);
        }

        .participants-header {
            padding: 12px 16px;
            border-bottom: 1px solid rgba(255,255,255,0.06);
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            color: #8e9297;
        }

        .participants-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .participant {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 4px;
        }

        .participant:hover {
            background: rgba(255,255,255,0.04);
        }

        .participant-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--discord-blurple);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
        }

        .participant-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .participant-info {
            flex: 1;
            min-width: 0;
        }

        .participant-name {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .participant-role {
            font-size: 12px;
            color: #8e9297;
        }

        .participant-role.host {
            color: var(--discord-green);
        }

        .participant-role.player {
            color: var(--discord-blurple);
        }

        .participant-role.spectator {
            color: #8e9297;
        }

        /* Control bar */
        .control-bar {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--discord-darker);
            border-top: 1px solid rgba(255,255,255,0.06);
        }

        .control-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.15s ease;
            gap: 8px;
        }

        .control-btn.primary {
            background: var(--discord-blurple);
            color: white;
        }

        .control-btn.primary:hover {
            background: #4752c4;
        }

        .control-btn.secondary {
            background: rgba(255,255,255,0.1);
            color: #dcddde;
        }

        .control-btn.secondary:hover {
            background: rgba(255,255,255,0.15);
        }

        .control-btn.danger {
            background: var(--discord-red);
            color: white;
        }

        .control-btn.danger:hover {
            background: #c43235;
        }

        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .control-btn svg {
            width: 18px;
            height: 18px;
        }

        /* Join as player button - prominent */
        .join-player-btn {
            background: linear-gradient(135deg, var(--discord-blurple), #7289da);
            padding: 12px 24px;
            font-size: 15px;
        }

        /* Fullscreen styles */
        .fullscreen .activity-header,
        .fullscreen .control-bar {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .fullscreen:hover .activity-header,
        .fullscreen:hover .control-bar {
            opacity: 1;
        }

        /* Mobile responsive */
        @media (max-width: 600px) {
            .participants-panel {
                width: 100%;
            }

            .control-bar {
                flex-wrap: wrap;
            }

            .control-btn {
                flex: 1;
                min-width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="activity-container" id="activity-container">
        <!-- Header -->
        <div class="activity-header">
            <div class="activity-title">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.5 0C19.985 0 22 2.015 22 4.5V19.5C22 21.985 19.985 24 17.5 24H6.5C4.015 24 2 21.985 2 19.5V4.5C2 2.015 4.015 0 6.5 0H17.5ZM12 6C8.686 6 6 8.686 6 12C6 15.314 8.686 18 12 18C15.314 18 18 15.314 18 12C18 8.686 15.314 6 12 6ZM12 8C14.209 8 16 9.791 16 12C16 14.209 14.209 16 12 16C9.791 16 8 14.209 8 12C8 9.791 9.791 8 12 8Z"/>
                </svg>
                <span>Cloud Gaming</span>
            </div>
            <div class="participant-count" id="participant-count">0 watching</div>
        </div>

        <!-- Stream container -->
        <div class="stream-container" id="stream-container">
            <video id="stream-video" autoplay playsinline></video>
            <canvas id="stream-canvas" style="display: none;"></canvas>

            <!-- Loading overlay -->
            <div class="stream-overlay" id="loading-overlay">
                <div class="loading-spinner"></div>
                <div class="loading-text" id="loading-text">Connecting to Discord...</div>
            </div>
        </div>

        <!-- Participants panel -->
        <div class="participants-panel" id="participants-panel">
            <div class="participants-header">Participants</div>
            <div class="participants-list" id="participants-list">
                <!-- Populated dynamically -->
            </div>
        </div>

        <!-- Control bar -->
        <div class="control-bar">
            <button class="control-btn primary join-player-btn" id="join-player-btn" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                Join as Player
            </button>
            <button class="control-btn secondary" id="participants-btn">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                </svg>
                <span id="participants-count-badge">0</span>
            </button>
            <button class="control-btn secondary" id="fullscreen-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                </svg>
            </button>
            <button class="control-btn danger" id="leave-btn" style="display: none;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
                </svg>
                Leave
            </button>
        </div>
    </div>

    <script type="module" src="./discord-activity.ts"></script>
</body>
</html>
